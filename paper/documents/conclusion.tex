\section{まとめ}
\label{section:まとめ}
\subsection{考察}
\label{subsection:考察}
観光案内アプリはコンテンツの配信を中心とするサービスである。現在配信されている観光案内アプリに実装されている機能の多くは先にユーザーからのアクションを必要とするため、Background Fetch APIやBackground Synchronization APIを使用したバックグラウンドでのコンテンツの取得や更新の需要はまだ小さいことが分かる。これらのWeb APIを使用したバックグラウンド処理はWebページの再読み込みの手間やコンテンツのダウンロードの手間を削減するが、ユーザーがその処理の流れを理解しにくいためプライバシー上の懸念がある。

一方で、現在配信されている観光案内アプリにおいては、GPSなどを使用した位置情報の取得が普及していることから、位置情報は観光地図などの機能を適切に動作させるために不可欠な仕組みであると言える。この仕組みをPWAに取り入れるためにはGeolocation APIを使用することが一般的である。アプリがGeolocation APIを使用してユーザーの位置情報にアクセスするためには、ユーザーがアプリに対してプロンプト経由で明示的にアクセスを許可する必要があり、かつユーザーにとってその流れが直感的であるため、観光案内アプリにおいて活用が期待される。

アプリの進化の歴史を踏まえると、アプリのインタラクティブ性は今後ますます高まると考えられる。前述したように、現在配信されている観光案内アプリの多くは受動的であり、アプリからユーザーへの積極的な情報発信が少ない。しかし、今後アプリのインタラクティブ化が進めば、ユーザーに適した観光名所の提案や、新しい観光名所の紹介がアプリのアクションをきっかけに行われるようになる可能性もある。このような機能がより一般的になれば、Push APIとNotifications APIを用いたプッシュ通知の価値が高まり、最終的にはPWAの有用性が向上するかもしれない。

ユーザー間で観光名所の情報を共有する機能を持った観光案内アプリもある。このような機能を実装する場合はMedia Capture and Streams APIを始めとするメディアの制御に関するWeb APIを利用できる。このWeb APIを用いることでファイルやストリームを容易に作成できる。ファイルやストリームを操作するWeb APIは多くのWebブラウザーがサポートしているが、ファイルシステムにアクセスするためのWeb APIは権限管理が不十分であるという理由で一部のWebブラウザーベンダーが反対している。権限が大きいWeb APIの規制により、ユーザーのプライバシーが守られやすくなる一方で、ネイティブアプリとWebアプリの間のユーザビリティーの格差が広まる可能性がある。

観光案内アプリにService Workerを追加するとコンテンツをキャッシュできるようになる。全てのネットワークレスポンスをキャッシュした場合は、2回目以降のページ読み込みではユーザーの端末内のストレージからそのコンテンツが取り出されるため、瞬時にページが表示され、最大のパフォーマンスを得られる。しかし、全てのネットワークレスポンスをキャッシュする方法を採用するとユーザーの端末内のストレージ容量を過剰に消費してしまう可能性がある。このような場合は特定の形式のファイルのみをキャッシュしたり、特定のオリジンのコンテンツのみをキャッシュしたりすることが推奨される。観光案内アプリで、画像をキャッシュした場合とSame-Originのネットワークレスポンスをキャッシュした場合を比べると、画像をキャッシュした場合はFCPの値が小さく、Same-Originのネットワークレスポンスをキャッシュした場合はSIの値が小さい。Same-OriginのネットワークレスポンスはHTML、CSS、JavaScript、JSONを中心に構成されるが、これらはいずれも画像に比べてファイルサイズが小さいため、Same-Originのネットワークレスポンスをキャッシュした場合はSIの値が小さくなりやすいと考えられる。一方で画像をキャッシュした場合は、ページの最初のコンテンツをレンダリングするために必要なHTMLをサーバーから取得する必要があるため、FCPが小さくなりやすいと考えられる。観光案内アプリでService Workerを使用することで、それぞれのアプリの特徴に合ったキャッシュ管理ができ、クライアントのストレージ容量の消費を節約しながらアプリのパフォーマンスを改善できる。TTIについては、JavaScriptのイベントハンドラーの実行が悪影響を及ぼしていると考えられる。特に、Webアプリに観光地図を実装する場合は、サムネイル表示や詳細表示を実現するために、mouseoverイベントやclickイベントを、観光名所を表すノード単位で監視するため、イベントハンドラーの実行時間が長くなりやすい。

PWAの導入後のパフォーマンスを計測する方法は改善の余地がある。例えば、ユーザーのインタラクションの遅延を計測することで、実際のユーザビリティーをより正確に評価できる。LighthouseはFirst Input Delay(FID)をInteraction to Next Paint(INP)に置き換えようとしている。FIDはユーザーが最初にページを操作してから、Webブラウザーが実際にイベントバンドラーの処理を開始するまでの時間を算出する。一方で、INPはユーザーがページで行う全てのインタラクションの遅延を計測し、最も長いインタラクションを算出する。INPはクリック、タップ、キーボードの押下のインタラクションを計測できるが、スクロールやズームのインタラクションは計測できない。これらのインタラクションは観光案内アプリに実装されることが多い機能の1つである観光地図で多用されるものであるため、それを考慮することでより正確なパフォーマンスを算出できる。

インタラクションの遅延はユーザビリティーに影響する。ISO 9241-11の定義によれば、モバイルアプリのユーザビリティーとは、特定の利用状況において、有効性、効率性、満足度を伴って特定の目標を達成するために特定のユーザーが製品を使用できる程度を指す。研究で扱われることが多い、モバイルアプリのユーザビリティーの属性の上位5つは、効率性、満足度、有効性、学びやすさ、覚えやすさである~\cite{PawelUsabilityofMobileApplications}。効率性はユーザーがタスクを迅速かつ正確に完了する能力である。満足度はユーザーが認識した快適さと喜びの程度である。有効性はユーザーが特定の状況でタスクを完了させる能力である。学びやすさはユーザーがガイダンスを受けたりドキュメントを参照したりすることなく、新たに遭遇したシステムと対話することが容易である程度や、ユーザーがアプリに習熟する能力である。覚えやすさはユーザーがアプリを効果的に使用する方法を覚えやすい程度である。インタラクションの遅延はユーザビリティーの属性のうち、効率性、満足度、有効性を低下させると考えられる。そのため、インタラクションの遅延を評価するための方法を確立することは、観光案内アプリに代表されるようなインタラクティブ性が高いアプリのユーザビリティーを高める上で重要である。

インタラクティブ性に影響する要素の1つはタスクの実行時間である。UIスレッドを長時間専有し、他の重要なタスクの実行をブロックするタスクはLong Tasksと呼ばれ、インタラクティブ性を低下させる原因の1つである。それに加えて、Long Tasksは入力遅延の増加/不安定化、イベントの処理遅延の増加/不安定化、不安定なアニメーションやスクロールを引き起こす。Long Tasksの詳細な情報を提供する仕組みとして、Long Tasks APIの標準化が進められている。Long Tasks APIをPerformance Timelineとともに使用することで、Webアプリのライフサイクル全体からLong Tasksを検出できる。特にLong Tasks APIは現在Working Draftであるため、今後新しい機能が追加される可能性がある。この仕様に新しい機能が追加された場合はパフォーマンスの評価方法を再検討する価値がある。

\subsection{結論}
\label{subsection:結論}
現在配信されている観光案内アプリに実装されている機能としては、観光地図、スタンプラリー、観光ルート案内などがあり、主な機能はユーザーの位置情報を使用していることが分かった。モバイル端末向けの観光案内アプリに実装されている機能のほとんどはPWAでも実装できるが、BluetoothやNFCなどの近距離通信に対応していないWebブラウザーや、それらに対してプライバシー上の懸念を表明しているベンダーが存在するため、近距離通信を使用したビーコンの読み取りをPWAで実現することは困難である。

関連研究ではアプリのパフォーマンスを評価する際にモバイル端末の通信環境や性能をエミュレートしていなかったが、この研究ではLighouseという品質測定ツールが提供しているモバイル端末のエミュレーションとThrottleというネットワークスロットリングライブラリを用いてそれらのエミュレーションを行った。PWAの中心的な要素であるService Workerのキャッシュ戦略を検討し、それらのキャッシュ戦略が観光案内アプリのパフォーマンスの向上にどのような影響を与えるのかを検証した。

LighouseとThrottleを使用してパフォーマンスを計測した場合は、PWAのインタラクティブ性を評価できないことが明らかになった。PWAのインタラクティブ性を評価できる可能性がある方法としては、Interaction to Next Paintを使用したユーザーのアクションに対する応答速度の計測や、Long Tasks APIを使用したLong Tasksの検出とその実行時間の計測がある。これらの方法は現在レビュー段階にあるため、さらなる検証が必要である。これらの方法によって算出される指標の値がPWAのインタラクティブ性とどの程度関連しているのかを明らかにすることで、PWAのパフォーマンスをより正確に算出できるようになり、PWAの活用が促進されると考えられる。