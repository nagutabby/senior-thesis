\section{研究内容}\label{section:研究内容}
%\begin{itemize}
%  \item Service Workerのパフォーマンス評価
%  \begin{itemize}
%    \item Lighthouseとネットワークスロットリングを用いることでService Workerのパフォーマンス評価ができることを示す
%    \item ネットワークスロットリングの種類や、パケットレベルのネットワークスロットリングを用いる利点を説明する
%  \end{itemize}
%\end{itemize}
観光案内アプリにPWAを導入することを想定して調査や分析を行う。まずはPWAと深い関わりがあるWeb APIの、PWAにおける有用性を調査する。続いてService Workerのパフォーマンスを評価する。
\subsection{PWAにおけるWeb APIの有用性の調査}\label{subsection:PWAにおけるWeb APIの有用性の調査}
Web APIはPWAをプラットフォーム固有のアプリ(ネイティブアプリ)に近づけるために不可欠な技術である。ネイティブアプリの機能の多くはSDK(Software Development Kit)により提供されている。SDKは、特定のフレームワークやプラットフォーム上にアプリケーションを構築するために使用する開発ツールのセットである。Webアプリ開発では、SDKの代わりにWeb APIを使用できる。API(Application Programming Interface)はプログラム同士が相互に通信するための方法である。SDKと同様に、開発者が複雑な機能をより簡単に作成できるようにするために提供されており、APIを使用することで複雑なコードが抽象化され、構文がより簡潔になる。Web APIはこのAPIの1つであり、HTTPなどのWebの技術を利用したものである。Web APIにはいくつかの種類があるが、この論文では特に、WebブラウザーのAPIのうち、W3Cなどにより標準化されたものを扱うことにする。以後この論文では、Webブラウザーの標準化されたAPIという意味でWeb APIという語句を使用する。
\subsubsection{Web APIのWebブラウザー側の対応状況の調査}\label{subsubsection:Web APIのWebブラウザー側の対応状況の調査}
開発者が実際に特定のWeb APIを利用するためには、WebブラウザーがそのWeb APIに対応している必要がある。特に、シェアが大きいWebブラウザーの対応状況や、レンダリングエンジンが異なるWebブラウザー間の対応状況を把握することは、Webアプリのコンバージョンを高めたり、自由なWebを維持したりする上で重要である。主要なWebブラウザーのシェアや特徴は以下の通りである。なお、シェアはすべてのプラットフォームの2023年9月時点のデータを基に算出している~\cite{StatCounterBrowserMarketShare}。
\begin{itemize}
    \item Google Chrome
    \begin{itemize}
        \item シェア: 約63\%
        \item レンダリングエンジン
        \begin{itemize}
            \item HTML: Blink
            \item JavaScript: V8
        \end{itemize}
        \item チャンネル~\cite{GoogleChromeChannels}
        \begin{itemize}
            \item Stable
            \item Extended Stable
            \item Beta
            \item Dev
            \item Canary
        \end{itemize}
    \end{itemize}
    \item Safari
    \begin{itemize}
        \item シェア: 約20\%
        \item レンダリングエンジン
        \begin{itemize}
            \item HTML: WebKit
            \item JavaScript: Nitro
        \end{itemize}
        \item チャンネル~\cite{SafariChannels}
        \begin{itemize}
            \item Safari
            \item Beta
            \item Technology Preview
        \end{itemize}
    \end{itemize}
    \item Microsoft Edge
    \begin{itemize}
        \item シェア: 約5\%
        \item レンダリングエンジン
        \begin{itemize}
            \item HTML: Blink
            \item JavaScript: V8
        \end{itemize}
        \item チャンネル~\cite{MicrosoftEdgeChannels}
        \begin{itemize}
            \item Stable
            \item Extended Stable
            \item Beta
            \item Dev
            \item Canary
        \end{itemize}
    \end{itemize}
    \item Mozilla Firefox
    \begin{itemize}
        \item シェア: 約3\%
        \item レンダリングエンジン
        \begin{itemize}
            \item HTML: Gecko
            \item JavaScript: SpiderMonkey
        \end{itemize}
        \item チャンネル~\cite{MozillaFirefoxChannels}
        \begin{itemize}
            \item Firefox
            \item Extended Support Release(ESR)
            \item Beta
            \item Developer Edition
            \item Nightly
        \end{itemize}
    \end{itemize}
\end{itemize}
次に、前述した情報を踏まえ、Webブラウザー間におけるWeb APIの対応状況の違いを考える上で、着目するべき点を挙げる。まずは、Google Chromeのシェアとその他のWebブラウザーのシェアの間に大きな差があることを確認できる。次に、Google ChromeとMicrosoft Edgeの特徴が似ていることを確認できる。Microsoft EdgeはGoogle Chromeと同様にChromiumというWebブラウザーから派生しているためである。Web APIの対応状況についてもほとんど同じである。そこで、Google ChromeとMicrosoft Edgeは同一のWebブラウザーであるとみなし、よりシェアが大きいGoogle Chromeを調査対象とする。

続いて、HTMLのレンダリングエンジンの違いに注目する。まず、SafariはBlinkのフォーク元であるWebKitを利用している。そのため、SafariにはGoogle ChromeやMicrosoft Edgeと共通のコードベースが含まれる可能性がある。さらに、WebKitは独自のエコシステムを持っている。例えば、iOS上のWebブラウザーはWebKit以外のHTMLレンダリングエンジンを使用できない。これにより、iOS上のWebブラウザー間の機能の違いが少なくなり、iOSにデフォルトでインストールされているSafariの市場優位性が高まる。Mozilla Firefoxについては、シェアは少ないものの、WebKitから完全に独立したHTMLレンダリングエンジンであるGeckoを採用している。また、プライバシーを重視する傾向にあり、PWAに関連するWeb APIの策定に積極的であるGoogle Chromeとは対照的である。そのため、Google Chromeに加えてMozilla Firefoxも調査対象とする。

次に、Web APIのWebブラウザー側の対応状況を調べる際に参照する文献の候補を示す。Can I use…~\cite{CanIUse}は様々なWebブラウザーがサポートする機能を検索できるWebサイトである。CC BY 4.0ライセンスを採用し、コミュニティーがWebサイトの情報を更新している。これに加えて、より信ぴょう性が高い情報を得るために、それぞれのWebブラウザーベンダーが提供しているRelease notesを参照する。これは、新しいバージョンのソフトウェアをリリースする際に公表される、以前のバージョンからの変更点を示す文書である。また、より詳細な情報を入手するために、必要に応じてWebブラウザーベンダーのブログ記事を参照する。
\subsubsection{Web APIに対する意見や主張の調査}\label{subsubsection:Web APIに対する意見や主張の調査}
それぞれのWeb APIに対する意見や主張は、Web APIの有用性を測るための1つの指標となり得る。Web APIに対する意見や主張を表明するための文書としてはStandards Positionsがある。これは、Web標準の技術に対する開発コミュニティーの立場をまとめたものである。主な立場としては賛成(support、positive)、中立(neutral)、反対(oppose、negative)がある。GitHubなどのプラットフォーム上で、特定のWeb標準の技術に対する賛否の議論が行われ、その後に開発コミュニティーの代表者が立場を表明する。まずは、Standards Positionsでの立場やその根拠となる議論を調査し、Web APIの現在の有用性を評価する。さらに、Web APIに対する議論の方向性を基にWeb APIの将来の見通しを考察する。
\subsection{Service Workerのパフォーマンスの評価}\label{subsection:Service Workerのパフォーマンスの評価}
観光案内アプリでのService Workerのパフォーマンスを評価するためには、観光案内アプリに求められる機能を調査し、検証用のアプリを作成し、Service Workerのキャッシュパターンを考え、パフォーマンスを計測することが必要である。
\subsubsection{観光案内アプリに求められる機能の調査}\label{subsubsection:観光案内アプリに求められる機能の調査}
人々が観光案内アプリと聞いて思い浮かべるものは様々である。そこで、観光案内アプリに求められる機能を調査する。初めにGoogle検索エンジンを使用して都道府県名、「観光」、「アプリ」というキーワードで検索する。次に、最上位の検索結果から順に閲覧していき、観光案内アプリを見つける。そのアプリが配信中であれば、PCやスマートフォンで実際にそのアプリを使用してアプリに実装されている機能を調査する。

\subsubsection{Service Workerのキャッシュ戦略}\label{Service Workerのキャッシュパターン}
Service Workerのキャッシュパターンはキャッシュ戦略と呼ばれ、Service Workerを効果的に使用するために必要である。どのコンテンツをキャッシュするべきかはアプリの内容によって異なるため、キャッシュ戦略は無数にあるが、参考までにいくつか例を示す。

まずは、Service Workerのインストール時に全てのアセットをキャッシュする戦略がある。この戦略ではService Workerはアセットのキャッシュのみを返すため、HTMLなどのネットワークリクエストはService Workerを経由せず、キャッシュされない。

あるいは、全てのネットワークリクエストをService Workerに経由させる戦略もある。この戦略ではコンテンツは一切キャッシュされないが、常に最新のネットワークレスポンスを受け取れる。しかし、ユーザーがオフラインのときはWebアプリが機能しない。

このように、Service Workerはネットワークリクエストを仲介する役割を持つ。そのため、Service Workerを用いて一部のコンテンツのみをキャッシュすることもできる。キャッシュ対象のコンテンツの種類や範囲を変化させることでSerivce Workerのパフォーマンス評価を行うことにし、3種類のキャッシュ戦略を策定した。

1つ目はすべてのネットワークレスポンスをキャッシュする戦略である。この戦略では、HTML、CSS、JavaScript、画像、JSONなどのあらゆるネットワークレスポンスがService Workerによって全てキャッシュされる。同じページがもう1度読み込まれると、全てのネットワークレスポンスがキャッシュを利用するため、実質的にネットワークリクエストが発生しない。

2つ目はSame-Originのネットワークレスポンスをキャッシュする戦略である。この戦略ではWebアプリがデプロイされているドメイン(Same-Origin)に対するネットワークリクエストのみがキャッシュされる。同じページがもう1度読み込まれると、Same-OriginのネットワークレスポンスはCache Storageにあるキャッシュを利用し、Cross-Originのネットワークレスポンスはそのキャッシュを利用しない。

3つ目は画像をキャッシュする戦略である。観光案内アプリでは多くの画像が配信されるため、画像を積極的にキャッシュした際のパフォーマンスを知ることは、観光案内アプリでのPWAの有用性を評価する上で重要である。